{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Cluster Config",
  "description": "Configuration for forwarding metrics from Atlas LWC to AWS CloudWatch",
  "type": "object",
  "required": [ "email", "expressions" ],
  "properties": {
    "email": {
      "description": "Email address of the service owner",
      "type": "string",
      "format": "email"
    },
    "expressions": {
      "description": "List of metric expressions",
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "type": "object",
        "required": [ "metricName", "atlasUri", "dimensions", "account" ],
        "properties": {
          "metricName": {
            "description": "Name of the metric that will be created in CloudWatch",
            "type": "string",
            "pattern": "^[a-zA-Z0-9]+[a-zA-Z0-9_\\-\\.]*[a-zA-Z0-9]+$"
          },
          "atlasUri": {
            "description": "Atlas query",
            "type": "string",
            "format": "uri"
          },
          "comment": {
            "type": "string"
          },
          "dimensions": {
            "description": "Details about AWS CloudWatch dimension that will be created",
            "type": "array",
            "minItems": 1,
            "uniqueItems": true,
            "items": {
              "type": "object",
              "required": [ "name", "value" ],
              "properties": {
                "name": {
                  "description": "Name of the CloudWatch dimension",
                  "type": "string",
                  "pattern": "^[a-zA-Z0-9]+[a-zA-Z0-9_\\-\\.]*[a-zA-Z0-9]+$"
                },
                "value": {
                  "description": "Atlas tag. Example: $(nf.asg)",
                  "type": "string",
                  "pattern": "^\\$\\([a-zA-Z0-9]+[a-zA-Z0-9\\.]*[a-zA-Z0-9]+\\)$"
                }
              }
            }
          },
          "account": {
            "description": "AWS account to send the metric to. Typically $(nf.account)",
            "type": "string",
            "pattern": "^\\$\\([a-zA-Z0-9]+[a-zA-Z0-9\\.]*[a-zA-Z0-9]+\\)$"
          }
        }
      }
    }
  }
}